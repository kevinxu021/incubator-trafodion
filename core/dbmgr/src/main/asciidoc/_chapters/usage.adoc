////
<!--
/**
  *(C) Copyright 2015 Esgyn Corporation
  *
  * Confidential computer software. Valid license from Esgyn required for
  * possession, use or copying. Consistent with FAR 12.211 and 12.212,
  * Commercial Computer Software, Computer Software Documentation, and
  * Technical Data for Commercial Items are licensed to the U.S. Government
  * under vendor's standard commercial license.
  *
  */
-->
////
[[usage]]
== Using EsgynDB Manager
:doctype: book
:numbered:
:toc: left
:icons: font
:experimental:

This chapter describes how to connect to EsgynDB Manager and use its features.

=== Connecting to EsgynDB Manager

Open a web browser and point to the host name on which EsgynDB Manager is running. You can use either the HTTP port or the HTTPS port number set in the EsgynDB Manager config file. If you use the HTTP port, the request is automatically redirected to the HTTPS port.

----
http://my.esgyndb.server:4205
----

Or

----
https://my.esgyndb.server:4206
----
=== Login
In the Login page, a valid EsgynDB database user name and password and click on the Login button. EsgynDB Manager relies on database authentication and makes a JDBC connection to authenticate the user.

=== Navigation
To Navigate the UI and access the different features, use the navigation menu at the top of the screen.
[[img-rest]]
image::navigation.png[caption="Figure 2: ", title="Navigation Menus"]


=== Dashboard

The dashboard page displays the status of the EsgynDB services, nodes and display time-series charts for key system and HBase metrics.

==== Service Status

The service status displays the status of the core EsgynDB services : *Transaction Manager, Connectivity Service and Runtime Manageability Service*.

For each service, you can see the number of configured processes, the number of actual running processes, the number of down processes if any.

- The status icon is green if all configured servers are up.
- The status icon is Yellow (Warning) if the number of actual servers is not equal to the configured servers.
- The status icon is RED (Error) if actual server count is 0 or if the actual servers are < 30% of the configured servers.

A tooltip on the status icon displays down process information if there are any. You can also export the data to a spreadsheet or clipboard.

The service status information is provided by the EsgynDB REST Server which invokes the sqcheck script.

==== Node Status

The node status displays the *Up* or *Down* status of the logical nodes configured in the EsgynDB cluster.
This information is provided by the EsgynDB REST Server which invokes the sqnodestatus script.

==== Transaction Counts
A time series chart to show the number of EsgynDB transaction begins, commits and aborts across all nodes.

The chart uses the OpenTSDB metrics *esgyndb.dtm.txnaborts*, *esgyndb.dtm.txnbegins*, *esgyndb.dtm.txncommits*.

These metrics are collected and published every 5 minutes.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== Canary Response
The response times from an EsgynDB database canary check. The metrics displayed are the time taken to open a JDBC connection, time take to perform DDL operations (drop and create canary table), time take to write (insert 9 rows) and time taken to read (select) from the canary table.

The chart uses the OpenTSDB metrics *esgyndb.canary.sqlconnect.time*, *esgyndb.canary.sqlddl.time*, *esgyndb.canary.sqlwrite.time* and *esgyndb.canary.sqlread.time*.

These metrics are collected and published every 5 minutes.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== IO Waits
The average IO Wait time percentage across all nodes.

The chart uses OpenTSDB metric *proc.stat.cpu{type=iowait}*.

Click on the zoom-in icon to open a drill-down page and view the IO Wait time for each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== Disk Space Used %
The average disk space used percentage across all nodes.

The chart uses OpenTSDB metric *df.bytes.percentused*.

Click on the zoom-in icon to open a drill-down page and view the disk usage % for each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== GC Time
The average JVM garbage collection time in milliseconds.

The chart uses OpenTSDB metric *hbase.regionserver.jvmmetrics.GcTimeMillis*.

Click on the zoom-in icon to open a drill-down page and view the average GC time for each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== Regionserver Memory Use
The average memory (MB) used by the regionservers.

The chart uses OpenTSDB metric *hbase.regionserver.jvmmetrics.MemHeapUsedM*.

Click on the zoom-in icon to open a drill-down page and view the average memory used by each regionserver/node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== Memstore Size
The total memstore size (MB) of the different regions in the cluster.

The chart uses OpenTSDB metric *hbase.regionserver.regions.memStoreSize*.

Click on the zoom-in icon to open a drill-down page and view the total memstore file size in each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== CPU Load
The average CPU Load average across all nodes.

The chart uses OpenTSDB metric *proc.loadavg.15min*.

Click on the zoom-in icon to open a drill-down page and view the average CPU load on each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

==== Network IO
The average network IO (In/Out) measured in MB.

The chart uses OpenTSDB metric +++<b>proc.net.bytes{direction=*}</b>+++.

Click on the zoom-in icon to open a drill-down page and view the average network IO on each node. Each line in the drill-down graph represents a node.

This feature is only available in the EsgynDB Enterprise Advanced Edition.

=== Workloads
The Workload pages display EsgynDB query details. This includes all EsgynDB queries including user and system queries.

==== Active Workloads
The active workloads page displays the list of active EsgynDB queries. This includes queries that are currently executing and queries that completed within the last 30 seconds. The information is obtained from the EsgynDB Runtime Manageability Service.

The list of queries are displayed as a tabular output with the following information:

*Time*::
The time when the information was fetched
*Last Activity Seconds*::
A positive number shows how long the query has been active and is still executing. A negative number shows how long since the query completed execution. Queries remain in RMS memory for 30 seconds after completion.
*Query ID*::
The unique identifier for the query.
*Execution State*::
The current state of the query. Valid values are OPEN, EXECUTING, DEALLOCATED or COMPLETED.
*Query Text*::
The SQL statement of the query.

You can click on the Query ID hyper-link to drill-down into the details of that specific query.

Use the *Action -> Refresh* menu to refresh the list of active queries.

==== Active Query Details
The active query details page displays a summary of the runtime metrics as well the operator level statistics for the selected query. The metrics are obtained from the EsgynDB Runtime Manageability Service.

The metrics that have changed since the last refresh for this query, are highlighted in blue color, so you can observe how the query is progressing. For example if the operator CPU time is increasing, you know the operator and the query is progressing. If the CPU time for the operator does not increase, it indicates that operator is waiting for some other resource.

The page is set to auto-refresh every 30 seconds by default. You can also use the *Action -> Refresh* menu to refresh the page and reload the latest metrics for the query.

Click on the *Explain* button to view the explain plan for this query.

Use the *Action -> Cancel* menu to cancel the executing query.

==== Historical Workloads
You can use the historical workloads page to view queries that have run for longer than configured threshold (default 60 seconds).

The threshold is defined by the *dcs.server.user.program.statistics.limit.time* property in dcs-site.xml. If this property is not explicitly set, then the default value of 60 seconds apply.

Queries that exceed this run threshold are recorded in the EsgynDB manageability repository tables in the "\_REPOS_" schema. The historical workloads page fetches the query summary from the *"\_REPOS_".METRIC_QUERY_TABLE*.

By default the page displays the queries that either started or completed in the last 1 hour or is still executing. You can use the *Filters* option to change your search parameters. In the filter dialog, you can specify different time range or use additional filters like specific application names or user names or queries that match a particular query text. All the filter predicates are applied using *AND* operator, meaning that only queries that match all the filter predicates are returned.

Use the *Action -> Refresh* action option to refresh the page.

You can click on the Query ID hyper-link to drill-down into the details of a particular query.

==== Historical Query Detail
The historical query details page displays the details for the selected query. The details are grouped together as summary, query text, connection metrics, compile time metrics and run time metrics. The compile metrics includes estimates from the compiler. The runtime metrics are the actuals reported by the Runtime Manageability Service. You can compare the compile time metrics to the run time metrics and analyze the query behavior.

Click on the *Explain* button to view the explain plan for this query.

Use the *Action -> Cancel* menu to cancel the query, if the query is a long running query and is still executing.

==== Query Plan
The Query Plan page displays the Query ID, the query text, a visual explain plan and a textual explain plan.

For a query that is currently active, the textual plan may not show initially. If the query ran longer than a minute, then the textual plan is obtained from the repository and displayed.

Use the *Action -> Refresh* menu to refresh the page and reload the visual and textual plans.

If you click on a specific node in the explain tree, you will see the metrics for that specific operator in a pop-up dialog.

You can use the *Action -> Cancel* menu to cancel the query if the query is still executing.

==== Cancel Query
You can invoke the cancel action from the Active Workload Detail, Historical Workload Detail and Query Plan pages.

If the query is in EXECUTING state, a cancel request will be submitted to EsgynDB engine. If the user has the necessary SQL privileges to cancel the query, the engine would schedule a cancel of the query.

=== Logs
The Logs page displays the log and event messages from the EsgynDB processes. The logs are fetched using the logs TMUDF which filters the log entries from all the EsgynDB log files and provides a single consolidated and time sequenced view.

The Log details include the following:

*Time*::
The time when the log event occurred
*Severity*::
The event severity (FATAL/ERROR/WARN/INFO/DEBUG)
*Component*::
The EsgynDB component name reporting the event
*Process*::
The component process reporting the event
*Error Code*::
Error code if applicable. SQL Errors have error codes.
*Message*::
The event message

Use the *Filters* button to specify custom filters for your search. You can filter the log entries using a time range, specific severity levels, component names, process names, error codes or message text.

The table below describes the component names:
[options="header"]
|===========================
|Component Name |Description
|MON | Monitor
|MXOSRVR | Master Executor
|SQL | SQL
|SQL.COMP | Compiler
|SQL.ESP | Executor Server Process
|SQL.EXE | Master Executor SQL
|SQL.LOB | SQL Large Objects
|SQL.SSCP | Runtime Manageability Service
|SQL.SSMP | Runtime Manageability Service
|SQL.UDR | User Defined Routines
|WDG | Watchdog
|DCS | Connectivity Servers
|===========================

=== DCS Servers
The DCS Servers page displays the current active DCS Server sessions and the available DCS servers. If the DCS server is in a connected state, you will see the user name, the application name and client workstation that is connected.

If a client connection is rejected with error message that no more DCS servers are available, you can use this page to confirm that all DCS servers are used up.

To increase the number of DCS servers, increase the number of configured servers in the *$DCS_INSTALL_DIR/conf/servers* file and restart DCS.


=== Query Workbench
The query workbench page allows you to execute ad hoc queries and view the results in a tabular form or to generate a visual and textual explain plan.

Type the SQL query text in the Query text area. The query text should in valid EsgynDB query syntax.

You can a ONLY use single EsgynDB SQL statement. It can be a DDL or DML statement. Compound SQL statements are not supported.

The SQL statement should conform to EsgynDB SQL syntax and any errors reported by the engine are displayed with full error text.


==== Execute Query
Use the *Execute* button to execute the query. For a query that returns a result set, the results are displayed in a tabular format. For non-select queries or queries that returns a scalar result, the results are displayed as normal text.

==== Explain Plan
You can use the *Explain* button to generate an explain plan for the query. You get a visual explain in a tree graph and also a textual plan.

You can right mouse click on the graph and move the graph around or use your mouse scroll key to zoom-in and zoom-out the graph.

If you click on a specific node in the tree, you can see the details and cost for that specific operator in a pop-up window.

==== Control Options
The Control options allow you enter SET statements or Control Query statements that can influence the query plan and execution.

You can use these options to tune your query performance. Refer to the SQL Reference manual for more details on the SET and Control query commands.

=== EsgynDB Time-Series Metrics
EsgynDB provides script that leverage the tcollector infrastructure and publish the following metrics as time series data points into OpenTSDB.

These metrics can then be queried and graphed as time series charts or used in alert rule templates for notifications.

[options="header"]
|===========================
|Metric Name |Description
|esgyn.hbase.regionserver | Number of region servers in running state.
|esgyn.hbase.running | Indicates if HBase is up. A value of 1 means up and 0 means down.
|esgyn.nodes.up | Number of nodes that are up
|esgyn.nodes.down | Number of nodes that are down
|esgyndb.canary.sqlconnect.time | Time in milliseconds to open a JDBC connection
|esgyndb.canary.sqlddl.time | Time in milliseconds to execute the canary drop table and create table commands
|esgyndb.canary.sqlread.time | Time in milliseconds to execute a select on the canary table
|esgyndb.canary.sqlwrite.time | Time in milliseconds to insert 9 rows into the canary table
|esgyndb.dtm.configure | Number of DTM processes that are down
|esgyndb.dtm.running | Number of DTM processes that are up
|esgyndb.dtm.txnaborts | Number of transaction aborts. This is a cumulative counter since the last sqstart. The delta can be computed in the TSD query.
|esgyndb.dtm.txnbegins | Number of transaction begins. This is a cumulative counter since the last sqstart. The delta can be computed in the TSD query.
|esgyndb.dtm.txncommits | Number of transaction committed. This is a cumulative counter since the last sqstart. The delta can be computed in the TSD query.
|esgyndb.mxosrvr.configure | Number of configured MXOSRVR processes
|esgyndb.mxosrvr.down | Number of MXOSRVR processes that are down
|esgyndb.mxosrvr.running | Number of MXOSRVR processes that are up
|esgyndb.rms.configure | Number of configured RMS processes
|esgyndb.rms.down | Number of RMS processes that are down
|esgyndb.rms.running | Number of RMS processes that are up
|===========================


=== Alerts
Alerts feature is only available in the EsgynDB Enterprise Advanced Edition.

DB Manager uses Bosun to monitor key system or workload metrics and generate notifications based on rule templates.

You can configure rule templates and notification templates in Bosun. When the rules evaluate to true, the alerts are notified. You configure your Bosun alert definitions in the *$MGBLTY_INSTALL_DIR/bosun/conf/bosun.conf* file.

Refer to the Bosun documentation at https://bosun.org/documentation.html for instructions on how to define the alert rule and notification templates.

Additionally, refer to the OpenTSDB documentation and the TCollector documentation to understand the type of metrics that are available and how to write the TSDB query expression that will be used in your Bosun alert template.

http://opentsdb.net/docs/build/html/index.html
http://opentsdb.net/docs/build/html/user_guide/utilities/tcollector.html

Using the Alerts page in DB Manager, you can view all active alerts for the selected time range.

The Alerts summary displays all the open and active alerts. You can narrow down the filter predicates using the *Filter* button and find alerts for specific time range and/or alert status and/or severity and/or alert text.

The Alert summary includes:

*Time*::
The time when the alert notification was generated.
*Alert Key*::
The Alert Key
*Alert*::
The subject text of the alert notification.
*Status*::
Status of the alert. Acknowledged or Un-Acknowledged.
*Severity*::
Severity State of the alert. Critical/Warning/Normal/Unknown.
*Active*::
Indicates if the alert is still active, meaning if the alert trigger condition still exists. Only inactive alerts can be closed.


*Silenced*::
Indicates if the alert has been silenced.

Click on the Alert Key hyperlink to drill-down into the details of a specific alert.

==== Alert Details
The alert detail page displays all the details of the alert. This includes the alert summary information as well as the detail information that was sent out in the notification. For example if you had configured the alert template to include graphs, the detail includes the graphs as well.

If the alert has been acknowledged already by a user, it shows who acknowledged or closed the alert, when the alert was updated and the notes entered during the update.

Use the *Actions* menu to update the alert. You can acknowledge new alerts and enter a comment. For alerts that are no longer active, meaning the alert condition is no longer true, you can close the alerts.

Refer to the Bosun documentation at https://bosun.org/documentation.html for more details.

=== About
Use the *Help->About* to view the version of DB Manager. The page also displays the version of the EsgynDB instance you are currently connected to. When you contact Esgyn for DB Manager technical support, provide the information in the About page.

=== Log Out
You can click on the user icon at the top right corner of the application and select the *Logout* option.
